/**
* @author æ¸…æ«
* @create_at 2022-07-09 21:46:26
* @description ğŸ¸æŸ¥è¯¢æ˜Ÿåº§è¿åŠ¿ï¼Œéœ€è¦å»å¤©è¡Œç½‘ç«™ç”³è¯·æ˜Ÿåº§è¿åŠ¿apiï¼Œå†è¾“å…¥keyæ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨
* @version v1.0.0
* @title æ˜Ÿåº§è¿åŠ¿
* @platform qq wx tg pgm web cron
* @rule ?è¿åŠ¿
* @priority 100
* @admin false
* @public true
*/

/*
var a=(new Bucket("b")).get("c");//å­˜å‚¨æ¡¶é‡Šä¹‰ï¼šbæ˜¯å­˜å‚¨æ¡¶åå­—ï¼Œcæ˜¯å­˜å‚¨æ¡¶çš„é”®åï¼Œaå°±æ˜¯å–å€¼å­˜å‚¨æ¡¶bä¸­é”®åä¸ºcçš„å¯¹åº”å€¼
*/

const s = sender

var astro=encodeURI(s.param(1))
var str=""

//keyè®¾ç½®æŒ‡ä»¤ï¼šset tianapi key xxxxxxxxx
var tianapi_key = (new Bucket("tianapi")).get("key");//å¤©è¡Œæ•°æ®ç”³è¯·çš„keyç½‘ç«™https://www.tianapi.com/ï¼Œè¦å…ˆç”³è¯·æ˜Ÿåº§è¿åŠ¿çš„apiæ¥å£ï¼Œæ²¡æœ‰ç”³è¯·è¿™ä¸ªæ¥å£ï¼Œæä¾›çš„keyä¾¿æ— æ•ˆã€‚


//s.reply(`${Bucket("tianapi").get("key")}`)//è¯»å–å¤©è¡Œapiçš„keyå€¼
//s.reply(tianapi_key)ç­‰åŒäºä¸Šä¸€æ¡





function main() {

  var content = request({
    // å†…ç½®httpè¯·æ±‚å‡½æ•°
    "url":"http://api.tianapi.com/star/index?key="+tianapi_key+"&astro="+astro,//è¯·æ±‚é“¾æ¥
    "method": "get", //è¯·æ±‚æ–¹æ³•
    "dataType": "json", //è¿™é‡Œæ¥å£ç›´æ¥è¿”å›æ–‡æœ¬ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šjsonç±»å‹æ•°æ®
  }).body

  if (content["code"] == 200){

    content=content.newslist
    for (var i=0;i<9;i++){
      tempstr=content[i].type + " : " +content[i].content+"\n"
      str+=tempstr
    }
    s.reply(str)
  } 
  else {
    s.reply(content.msg)
  }
}

main()
