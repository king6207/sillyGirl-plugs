/**
* @author æ¸…æ«
* @version v1.0.0
* @create_at 2022-09-08 09:35:39
* @description ğŸ’å®˜æ–¹æŠ–éŸ³è§†é¢‘æ— æ°´å°è§£æ
* @title æŠ–éŸ³å»æ°´å°
* @platform qq wx tg pgm web cron
* @rule raw (https?://v\.douyin\.com/\w+/?)
* @priority 100
* @public true
* @admin false
*/

//è¯·åœ¨æ¶ˆæ¯æ¡†è¾“å…¥å¹¶å‘é€ï¼šä½ å¥½ ä½©å¥‡
//å»ºè®®åŒæ—¶æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°

//sender
const s = sender
/*
const kw = s.param(1)
//æ­£åˆ™å–å€¼ï¼Œå€Ÿé‰´çƒŸé›¨å¤§ä½¬çš„æ­£åˆ™åŒ¹é…
var ts = httpString(kw)[0];
//æ­£åˆ™
function httpString(s) {
	var reg = /(https?|http|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g
	s = s.match(reg)
	return s
}
*/
function main() {

	var url = s.param(1)
	var data = request({
		url: url,
		dataType: "location",
		headers: {
				'User-Agent':
				'Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Mobile Safari/537.36'
				}
	}				);
//    s.reply("æµç¨‹æ­£å¸¸2")
	aaa=data.body

	var ids = aaa.match(/\d{19}/);//æ­£åˆ™åŒ¹é…åˆ°äº†12345678901234567è¿™ä¸€ä¸²å«æœ‰17ä¸ºæ•°å­—ID
//	s.reply(ids)	//æ‰“å°å‡ºåˆ†äº«çš„æŠ–éŸ³è§†é¢‘ID

	var url ="https://www.iesdouyin.com/web/api/v2/aweme/iteminfo/?item_ids=" + ids;
//	s.reply(url)

	var json = request({		//è·å–å¯¹åº”æŠ–éŸ³è§†é¢‘IDçš„ç”µè„‘è®¿é—®æ•°æ®
		url: url,
		method: "get",
		dataType: "location",
		headers: {
			"User-Agent":
				"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Mobile/15E148 Safari/604.1",
			"Accept-Language": "zh-CN,zh-Hans;q=0.9",
		},
	}).body;

//	console.log(json)
	var json = JSON.parse(json);	//å°†å–å¾—çš„bodyæ•°æ®è¿›è¡Œæ ¼å¼åŒ–ï¼Œæ‰å¯è¿›è¡Œåç»­å–å€¼
	var list = json.item_list[0];	//æ— æ°´å°è§†é¢‘è¿æ¥åœ¨item_listæ•°æ®ç»„ä¸­
//  console.log(list.video.play_addr.url_list[0]);
//	s.reply(list.video.play_addr.url_list[0])	//æˆåŠŸå–å¾—æ— æ°´å°è§†é¢‘é“¾æ¥

	var abc	= list.video.play_addr.url_list[0];	//å–å‡ºå¸¦æœ‰è§†é¢‘æ°´å°çš„é“¾æ¥
//	s.reply(abc)
//	var playurl = json.item_list[0].video.play_addr.url_list[0];
//	s.reply(playurl);
	s.reply(abc.replace("playwm", "play"));	//å°†æœ‰æ°´å°çš„è§†é¢‘é“¾æ¥è¿›è¡Œæ— æ°´å°æ›¿æ¢
}

main();
